<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Training Logs - Gypsy Service Dog Training</title>
  <link rel="stylesheet" href="<%= typeof baseUrl !== 'undefined' ? baseUrl : '.' %>/css/style.css">
</head>
<body>
  <%- include('partials/header') %>
  <%- include('partials/nav-enhanced') %>

  <main class="container">
    <h1>üìù Training Logs</h1>

    <div class="tabs">
      <button class="tab-btn active" data-tab="daily">Daily Logs</button>
      <button class="tab-btn" data-tab="weekly">Weekly Reports</button>
      <button class="tab-btn" data-tab="add">Add New Log</button>
    </div>

    <div class="tab-content active" id="daily-tab">
      <h2>Daily Training Sessions</h2>
      <% if (data.trainingLogs.length === 0) { %>
        <div class="empty-state">
          <p>üìã No training logs yet!</p>
          <p>Click "Add New Log" to start tracking Gypsy's training sessions.</p>
        </div>
      <% } else { %>
        <div class="logs-container">
          <% data.trainingLogs.forEach(log => { %>
            <div class="log-card" data-log-id="<%= log.id %>">
              <div class="log-header">
                <h3><%= new Date(log.date).toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></h3>
                <span class="log-session-badge"><%= log.session %></span>
                <button class="btn-delete" onclick="deleteLog(<%= log.id %>)">üóëÔ∏è</button>
              </div>

              <% if (log.exercise) { %>
                <div class="log-section">
                  <h4>üèÉ Exercise</h4>
                  <p><strong>Duration:</strong> <%= log.exercise.duration %> minutes</p>
                  <p><strong>Type:</strong> <%= log.exercise.type %></p>
                  <p><strong>Energy Level After:</strong> <%= log.exercise.energyLevel %>/10</p>
                </div>
              <% } %>

              <% if (log.commands && log.commands.length > 0) { %>
                <div class="log-section">
                  <h4>üéì Commands Practiced</h4>
                  <table class="commands-table">
                    <thead>
                      <tr>
                        <th>Command</th>
                        <th>Reps</th>
                        <th>Success Rate</th>
                        <th>Environment</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% log.commands.forEach(cmd => { %>
                        <tr>
                          <td><%= cmd.command %></td>
                          <td><%= cmd.reps %></td>
                          <td><span class="success-rate" data-rate="<%= cmd.successRate %>"><%= cmd.successRate %>%</span></td>
                          <td><%= cmd.environment %></td>
                        </tr>
                      <% }) %>
                    </tbody>
                  </table>
                </div>
              <% } %>

              <% if (log.taskTraining) { %>
                <div class="log-section">
                  <h4>üéØ Task Training</h4>
                  <p><strong>Task:</strong> <%= log.taskTraining.task %></p>
                  <p><strong>Duration:</strong> <%= log.taskTraining.duration %> minutes</p>
                  <p><strong>Success Rate:</strong> <span class="success-rate" data-rate="<%= log.taskTraining.successRate %>"><%= log.taskTraining.successRate %>%</span></p>
                  <% if (log.taskTraining.challenges) { %>
                    <p><strong>Challenges:</strong> <%= log.taskTraining.challenges %></p>
                  <% } %>
                  <% if (log.taskTraining.breakthroughs) { %>
                    <p class="breakthrough"><strong>‚ú® Breakthroughs:</strong> <%= log.taskTraining.breakthroughs %></p>
                  <% } %>
                </div>
              <% } %>

              <% if (log.publicAccess) { %>
                <div class="log-section">
                  <h4>üåç Public Access Work</h4>
                  <p><strong>Location:</strong> <%= log.publicAccess.location %></p>
                  <p><strong>Duration:</strong> <%= log.publicAccess.duration %> minutes</p>
                  <p><strong>Performance:</strong> <%= log.publicAccess.performance %>/10</p>
                  <% if (log.publicAccess.issues) { %>
                    <p><strong>Issues to Address:</strong> <%= log.publicAccess.issues %></p>
                  <% } %>
                </div>
              <% } %>

              <% if (log.gypsyState) { %>
                <div class="log-section">
                  <h4>üêï Gypsy's State</h4>
                  <div class="state-grid">
                    <div><strong>Focus:</strong> <%= log.gypsyState.focus %>/10</div>
                    <div><strong>Energy:</strong> <%= log.gypsyState.energy %>/10</div>
                    <% if (log.gypsyState.stress) { %>
                      <div><strong>Stress Signals:</strong> <%= log.gypsyState.stress %></div>
                    <% } %>
                  </div>
                </div>
              <% } %>

              <% if (log.notes) { %>
                <div class="log-section">
                  <h4>üìå Notes</h4>
                  <p><%= log.notes %></p>
                </div>
              <% } %>
            </div>
          <% }) %>
        </div>
      <% } %>
    </div>

    <div class="tab-content" id="weekly-tab">
      <h2>Weekly Progress Reports</h2>
      <% if (data.weeklyReports.length === 0) { %>
        <div class="empty-state">
          <p>üìä No weekly reports yet!</p>
          <p>Complete your first week of training to add a weekly summary.</p>
        </div>
      <% } else { %>
        <div class="reports-container">
          <% data.weeklyReports.forEach(report => { %>
            <div class="report-card">
              <h3>Week of <%= new Date(report.weekOf).toLocaleDateString() %></h3>
              <div class="report-stats">
                <div class="stat">
                  <strong>Training Hours:</strong> <%= report.totalTrainingHours %>
                </div>
                <div class="stat">
                  <strong>Exercise Hours:</strong> <%= report.totalExerciseHours %>
                </div>
              </div>

              <% if (report.commandsMastered && report.commandsMastered.length > 0) { %>
                <div class="report-section">
                  <h4>‚úÖ Commands Mastered</h4>
                  <ul>
                    <% report.commandsMastered.forEach(cmd => { %>
                      <li><%= cmd %></li>
                    <% }) %>
                  </ul>
                </div>
              <% } %>

              <% if (report.victories && report.victories.length > 0) { %>
                <div class="report-section success">
                  <h4>üéâ Victories</h4>
                  <ul>
                    <% report.victories.forEach(victory => { %>
                      <li><%= victory %></li>
                    <% }) %>
                  </ul>
                </div>
              <% } %>

              <% if (report.challenges && report.challenges.length > 0) { %>
                <div class="report-section warning">
                  <h4>‚ö†Ô∏è Challenges</h4>
                  <ul>
                    <% report.challenges.forEach(challenge => { %>
                      <li><%= challenge %></li>
                    <% }) %>
                  </ul>
                </div>
              <% } %>

              <% if (report.nextWeekFocus) { %>
                <div class="report-section">
                  <h4>üéØ Next Week's Focus</h4>
                  <p><%= report.nextWeekFocus %></p>
                </div>
              <% } %>
            </div>
          <% }) %>
        </div>
      <% } %>
      <button class="btn btn-primary" onclick="showWeeklyReportForm()">Add Weekly Report</button>
    </div>

    <div class="tab-content" id="add-tab">
      <h2>Add Training Log</h2>
      <form id="training-log-form" class="form-card">
        <div class="form-group">
          <label for="date">Date</label>
          <input type="date" id="date" name="date" required value="<%= new Date().toISOString().split('T')[0] %>">
        </div>

        <div class="form-group">
          <label for="session">Training Session</label>
          <select id="session" name="session" required>
            <option value="Morning">Morning</option>
            <option value="Midday">Midday</option>
            <option value="Afternoon">Afternoon</option>
            <option value="Evening">Evening</option>
          </select>
        </div>

        <h3>Exercise</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="exercise-duration">Duration (minutes)</label>
            <input type="number" id="exercise-duration" name="exercise-duration" min="0">
          </div>
          <div class="form-group">
            <label for="exercise-type">Type</label>
            <input type="text" id="exercise-type" name="exercise-type" placeholder="e.g., Fetch, Walk, Run">
          </div>
          <div class="form-group">
            <label for="energy-level">Energy Level After (1-10)</label>
            <input type="number" id="energy-level" name="energy-level" min="1" max="10">
          </div>
        </div>

        <h3>Task Training</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="task-name">Task</label>
            <input type="text" id="task-name" name="task-name" placeholder="e.g., Deep Pressure Therapy">
          </div>
          <div class="form-group">
            <label for="task-duration">Duration (minutes)</label>
            <input type="number" id="task-duration" name="task-duration" min="0">
          </div>
          <div class="form-group">
            <label for="task-success">Success Rate (%)</label>
            <input type="number" id="task-success" name="task-success" min="0" max="100">
          </div>
        </div>

        <div class="form-group">
          <label for="task-challenges">Challenges</label>
          <textarea id="task-challenges" name="task-challenges" rows="2"></textarea>
        </div>

        <div class="form-group">
          <label for="task-breakthroughs">Breakthroughs</label>
          <textarea id="task-breakthroughs" name="task-breakthroughs" rows="2"></textarea>
        </div>

        <h3>Gypsy's State</h3>
        <div class="form-row">
          <div class="form-group">
            <label for="focus-level">Focus Level (1-10)</label>
            <input type="number" id="focus-level" name="focus-level" min="1" max="10">
          </div>
          <div class="form-group">
            <label for="gypsy-energy">Energy Level (1-10)</label>
            <input type="number" id="gypsy-energy" name="gypsy-energy" min="1" max="10">
          </div>
        </div>

        <div class="form-group">
          <label for="notes">Notes</label>
          <textarea id="notes" name="notes" rows="4" placeholder="What went well? What to work on? Training goal for tomorrow?"></textarea>
        </div>

        <button type="submit" class="btn btn-primary btn-large">Save Training Log</button>
      </form>
    </div>
  </main>

  <%- include('partials/footer') %>
  <script src="<%= typeof baseUrl !== 'undefined' ? baseUrl : '.' %>/js/main.js"></script>
  <script src="<%= typeof baseUrl !== 'undefined' ? baseUrl : '.' %>/js/training-log.js"></script>
</body>
</html>
